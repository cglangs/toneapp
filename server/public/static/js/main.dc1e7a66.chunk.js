(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{128:function(e,t,n){"use strict";n.r(t);var s=n(0),r=n(2),i=n.n(r),c=n(77),a=n.n(c),o=n(15),l=n(16),d=n(18),u=n(17),h=n(19),p=n(7),j=n(20),b=n(130);function _(){var e=Object(h.a)(["\n  mutation LoginMutation($email: String!, $password: String!) {\n    Login(user_email: $email, user_password: $password) {\n      _id\n      user_name\n      user_password\n      user_role\n    }\n  }\n"]);return _=function(){return e},e}function g(){var e=Object(h.a)(["\n  mutation UpgradeMutation($email: String!, $password: String!, $user_name: String!) {\n    UpgradeUser(user_email: $email, user_password: $password, user_name: $user_name) {\n      _id\n      user_name\n      user_password\n      user_role\n    }\n  }\n"]);return g=function(){return e},e}function m(){var e=Object(h.a)(["\n  mutation SignupMutation($email: String!, $password: String!, $user_name: String!, $role: String!) {\n    CreateUser(user_email: $email, user_password: $password, user_name: $user_name, user_role: $role) {\n      _id\n      user_name\n      user_password\n      user_role\n    }\n  }\n"]);return m=function(){return e},e}var f=Object(j.a)(m()),x=Object(j.a)(g()),v=Object(j.a)(_()),O=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(o.a)(this,n);for(var s=arguments.length,r=new Array(s),i=0;i<s;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state={isLogin:!0,email:"",password:"",user_name:"",userId:null,role:"STUDENT"},e}return Object(l.a)(n,[{key:"componentDidMount",value:function(){if(this.props.user){var e=this.props.user,t=e.user_name,n=e.user_id,s=e.user_role;this.setUserInfo(t,parseInt(n),s)}}},{key:"setUserInfo",value:function(e,t,n){this.setState({user_name:e,userId:t,role:n})}},{key:"render",value:function(){var e=this,t=this.state,n=t.isLogin,r=t.email,i=t.password,c=t.user_name,a=t.userId,o=t.role;return Object(s.jsxs)("div",{children:[Object(s.jsx)("h4",{children:n?"Login":"Sign Up"}),Object(s.jsxs)("div",{className:"flex flex-column",children:[!n&&Object(s.jsx)("input",{value:c,onChange:function(t){return e.setState({user_name:t.target.value})},type:"text",placeholder:"Your name"}),Object(s.jsx)("input",{value:r,onChange:function(t){return e.setState({email:t.target.value})},type:"text",placeholder:"Your email address"}),Object(s.jsx)("input",{value:i,onChange:function(t){return e.setState({password:t.target.value})},type:"password",placeholder:"Choose a safe password"})]}),Object(s.jsx)("div",{children:Object(s.jsx)(b.a,{mutation:n?v:"TESTER"===o?x:f,variables:{email:r,password:i,user_name:c,userId:a,role:"STUDENT"},onCompleted:function(t){return e._confirm()},onError:function(e){return console.log(e.message)},children:function(t,r){r.loading;var i=r.error;return Object(s.jsxs)("div",{children:[Object(s.jsx)("button",{type:"button",onClick:function(n){return e.handleLogin(n,t)},disabled:!e.state.email.length||!e.state.password.length||!e.state.user_name.length&&!e.state.isLogin,children:n?"login":"create account"}),Object(s.jsx)("button",{type:"button",onClick:function(){return e.setState({isLogin:!e.state.isLogin})},children:n?"need to create an account?":"already have an account?"}),i&&Object(s.jsx)("p",{children:i.message.substring(i.message.lastIndexOf(":")+1)})]})}})})]})}},{key:"handleLogin",value:function(e,t){e.preventDefault(),t()}},{key:"_confirm",value:function(){this.props.history.push("/"),window.location.reload(!0)}}]),n}(r.Component),y=Object(p.g)(O),k=n(23),w=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e=this,t=!!function(e){for(var t=e+"=",n=decodeURIComponent(document.cookie).split(";"),s=0;s<n.length;s++){for(var r=n[s];" "===r.charAt(0);)r=r.substring(1);if(0===r.indexOf(t))return r.substring(t.length,r.length)}return""}("access-token"),n=this.props.location.pathname;return console.log(n),Object(s.jsxs)("div",{children:[Object(s.jsx)("div",{children:"/dashboard"!==n&&Object(s.jsx)("div",{className:"flex",children:Object(s.jsx)(k.b,{to:"/dashboard",children:"Dashboard"})})}),"/login"!==n&&Object(s.jsx)("div",{className:"flex flex-fixed",children:t&&this.props.user&&"TESTER"!==this.props.user.user_role?Object(s.jsx)("div",{onClick:function(){document.cookie="access-token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",document.cookie="refresh-token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",e.props.history.push("/"),window.location.reload(!0)},children:"Logout"}):Object(s.jsx)(k.b,{to:"/login",children:"Login"})})]})}}]),n}(r.Component),S=Object(p.g)(w);function C(){var e=Object(h.a)(["\nquery getPhraseList($deck_id: Int!) {\n  getPhrasesInDeck(deck_id: $deck_id) {\n    _id\n    phrase_order\n    full_phrase\n    phrase_no_punctuation\n    word_list\n    pinyin\n    pinyin_no_tones\n    written_tones\n    spoken_tones\n    is_completed_char\n    is_completed_full\n  }\n}\n"]);return C=function(){return e},e}function I(){var e=Object(h.a)(["\nquery getDeckList {\n  getDecks {\n    deck_id\n    deck_name\n  }\n}\n"]);return I=function(){return e},e}var P=Object(j.a)(I()),N=Object(j.a)(C()),R=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,i=new Array(r),c=0;c<r;c++)i[c]=arguments[c];return(e=t.call.apply(t,[this].concat(i))).state={deckIndexSelected:null},e.selectMenuItem=function(t){e.setState((function(e){return{deckIndexSelected:e.deckIndexSelected===t?null:t}}))},e.getPhraseList=function(e){return Object(s.jsx)(b.b,{query:N,variables:{deck_id:e},children:function(t){var n=t.loading,r=t.error,i=t.data;t.refetch;return n?Object(s.jsx)("div",{children:"Fetching"}):r?Object(s.jsx)("div",{children:"error"}):Object(s.jsx)("div",{className:"menuSubItemContainer",children:i.getPhrasesInDeck.map((function(t){return Object(s.jsxs)("div",{className:"menuSubItem",children:[Object(s.jsx)("span",{style:{display:"inlineBlock",minWidth:"50%"},children:t.full_phrase}),Object(s.jsxs)(k.b,{className:"menuSubItemLink tooltip",to:{pathname:"/learn/"+e+"/"+t.phrase_order,state:{isFullSentenceMode:!1}},children:["Char Mode",Object(s.jsx)("span",{class:"tooltiptext",children:"Practice each character separately"})]}),Object(s.jsx)("span",{className:"circle "+(t.is_completed_char?"":"hide")}),Object(s.jsxs)(k.b,{className:"menuSubItemLink tooltip",to:{pathname:"/learn/"+e+"/"+t.phrase_order,state:{isFullSentenceMode:!0}},children:["Full Mode",Object(s.jsx)("span",{class:"tooltiptext",children:"Practice entire phrase"})]}),Object(s.jsx)("span",{className:"circle "+(t.is_completed_char?"":"hide")})]})}))})}})},e}return Object(l.a)(n,[{key:"render",value:function(){var e=this;return Object(s.jsx)(b.b,{query:P,children:function(t){var n=t.loading,r=t.error,i=t.data;t.refetch;return n?Object(s.jsx)("div",{children:"Fetching"}):r?Object(s.jsx)("div",{children:"error"}):Object(s.jsxs)("div",{className:"menuContainer",children:[Object(s.jsx)("div",{className:"menuHeader"}),Object(s.jsxs)("div",{className:"menuList",children:[i.getDecks.map((function(t,n){return Object(s.jsxs)("div",{className:"menuItem",onClick:function(){return e.selectMenuItem(n)},children:[Object(s.jsx)("p",{children:t.deck_name}),Object(s.jsx)("span",{className:n===e.state.deckIndexSelected?"chevron bottom":"chevron top"})]})})),null!==e.state.deckIndexSelected&&e.getPhraseList(1)]})]})}})}}]),n}(r.Component),A=n(59),D=n(21),L=n.n(D),T=n(34),E=n(32),$=n(24),U=n(49),B=n.n(U),M=n(50),F=n.n(M),q=n(37),z=n.n(q),V=(n(75),n(76),F.a.connect("".concat("http://localhost:5000"))),G=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).initRecorder=function(e){return z()(e,{type:"audio",sampleRate:44100,bufferSize:2048,numberOfAudioChannels:1,recorderType:z.a.StereoAudioRecorder})},r.componentDidMount=function(){V.on("predicted_tone",(function(e){var t="_"===r.state.test_sentence.spoken_tones[e.index]?"_":e.prediction.toString(),n=Object(E.a)(r.state.tones_recorded);n.splice(e.index,1,t),r.setState({tones_recorded:n},(function(){r.checkPhrase()}))}))},r.componentDidUpdate=function(e){e.sentence.phrase_order&&e.sentence.phrase_order!==r.props.sentence.phrase_order&&(console.log("UPDATE"),r.setState({test_sentence:r.props.sentence}))},r.checkPhrase=function(){var e=!1;!r.state.sentence_finished&&r.state.automatic_mode?r.startRecording():r.state.sentence_finished&&(e=r.state.tones_recorded.every((function(e,t){return e===r.state.test_sentence.spoken_tones[t]}))),e&&r.props.user&&!r.state.test_sentence.is_completed_char&&r.props.mutationFunction(!0,r.state.test_sentence.is_completed_full)},r.saveRecording=function(e,t){e.src=URL.createObjectURL(t);var n=r.state.tones_recorded.length===r.state.test_sentence.spoken_tones.length-1&&r.state.currentIndex===r.state.test_sentence.spoken_tones.length-1,s=r.state.automatic_mode&&!n,i=n||r.state.show_pinyin,c=r.state.currentIndex,a=Object(E.a)(r.state.new_audio);a.splice(r.state.currentIndex,1,e),r.setState({voice_present:!1,new_audio:a,recording:!1,currentIndex:c+1,sentence_finished:n,automatic_mode:s,show_pinyin:i},(function(){V.emit("tone_recorded",{voice_recording:t,character_index:c,threshold:r.state.threshold_decibels})}))},r.startRecording=function(){var e=Object($.a)(r),t=document.getElementById("replay-"+e.state.currentIndex);navigator.mediaDevices.getUserMedia({audio:!0}).then(function(){var n=Object(T.a)(L.a.mark((function n(s){var r;return L.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:e.recorder=e.initRecorder(s),r={threshold:-1*e.state.threshold_decibels},e.speechEvents=B()(s,r),e.recorder.startRecording(),e.speechEvents.on("speaking",(function(){console.log("speaking"),e.setState({voice_present:!0,predicted_tone:null})})),e.speechEvents.on("stopped_speaking",(function(){console.log("STOPPED SPEAKING"),e.recorder.stopRecording(Object(T.a)(L.a.mark((function n(){var s;return L.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e.speechEvents.stop(),n.next=3,e.recorder.getBlob();case 3:s=n.sent,e.saveRecording(t,s);case 5:case"end":return n.stop()}}),n)}))))})),e.setState({recording:!0});case 7:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())},r.toggleMode=function(){r.setState({automatic_mode:!r.state.automatic_mode})},r.togglePinyin=function(){r.setState({show_pinyin:!r.state.show_pinyin})},r.replayAudio=function(){r.state.new_audio.length&&r.state.new_audio[r.state.currentIndex].play()},r.playNativeVoice=function(){var e=r.state.test_sentence.pinyin_no_tones[r.state.currentIndex],t=r.state.test_sentence.spoken_tones[r.state.currentIndex];new Audio("/native_voice_audio/"+e+t+"_FV1_MP3.mp3").play()},r.restartSentence=function(){r.setState({currentIndex:0,tones_recorded:[],sentence_finished:!1,new_audio:[],recording:!1,automatic_mode:!1,show_pinyin:!1})},r.handleCharClick=function(e){e<=r.state.tones_recorded.length&&r.setState({currentIndex:e})},r.diplayString=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.split("");return Object(s.jsx)("span",{className:"String-holder charByChar",children:n.map((function(e,n){return t&&n===r.state.currentIndex?Object(s.jsx)("mark",{onClick:function(){return r.handleCharClick(n)},children:e},n):!t&&n<=r.state.tones_recorded.length-1&&r.state.test_sentence.spoken_tones[n]==r.state.tones_recorded[n]?Object(s.jsx)("mark",{style:{backgroundColor:"green"},onClick:function(){return r.handleCharClick(n)},children:e},n):!t&&n<=r.state.tones_recorded.length-1&&r.state.test_sentence.spoken_tones[n]!=r.state.tones_recorded[n]?Object(s.jsx)("mark",{style:{backgroundColor:"red"},onClick:function(){return r.handleCharClick(n)},children:e},n):Object(s.jsx)("span",{onClick:function(){return r.handleCharClick(n)},children:e},n)}))})},r.recordingButtonClick=function(){var e=Object($.a)(r);e.state.recording?e.setState({automatic_mode:!1,recording:!1},(function(){e.state.recorder.stopRecording(Object(T.a)(L.a.mark((function t(){return L.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.state.harkObject.stop();case 1:case"end":return t.stop()}}),t)}))))})):e.startRecording()},r.state={threshold_decibels:50,voice_present:!1,recording:!1,new_audio:[],tones_recorded:[],currentIndex:0,sentence_finished:!1,automatic_mode:!1,show_pinyin:!1},r.state.test_sentence=r.props.sentence,r.recorder=null,r.speechEvents=null,r}return Object(l.a)(n,[{key:"render",value:function(){this.state.recording,this.state.sentence_finished&&this.state.test_sentence.spoken_tones;return Object(s.jsxs)("div",{children:[this.state.test_sentence.characters.split("").map((function(e,t){return Object(s.jsx)("audio",{id:"replay-"+t},t)})),Object(s.jsxs)("div",{style:{display:"inline-flex",flexDirection:"column"},children:[Object(s.jsx)("p",{style:{textAlign:"center",height:"1vh"},children:this.state.show_pinyin&&this.state.test_sentence.pinyin}),Object(s.jsx)("span",{className:"circle "+(this.props.isComplete()?"":"hide")}),Object(s.jsx)("span",{style:{textAlign:"center"},children:this.state.test_sentence.display}),this.diplayString(this.state.test_sentence.characters,!0),this.diplayString(this.state.tones_recorded.join(""),!1)]}),Object(s.jsxs)("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",marginTop:"20px",marginBottom:"20px"},children:[Object(s.jsxs)("button",{className:"tooltip",disabled:this.state.currentIndex>=this.state.test_sentence.spoken_tones.length,onClick:this.recordingButtonClick,children:[Object(s.jsx)("img",{style:{padding:"0",height:"7vh",width:"4vw"},src:"/record-voice-button.svg"}),Object(s.jsx)("span",{class:"tooltiptext",children:"Record voice"})]}),Object(s.jsxs)("button",{className:"tooltip",disabled:this.state.currentIndex>=this.state.tones_recorded.length,onClick:this.replayAudio,children:[Object(s.jsx)("img",{style:{padding:"0",height:"7vh",width:"4vw"},src:"/play-button.svg"}),Object(s.jsx)("span",{class:"tooltiptext",children:"Replay recording for selected character"})]}),Object(s.jsxs)("button",{className:"tooltip",disabled:0===this.state.tones_recorded.length,onClick:this.restartSentence,children:[Object(s.jsx)("img",{style:{padding:"0",height:"7vh",width:"4vw"},src:"/delete-button.svg"}),Object(s.jsx)("span",{class:"tooltiptext",children:"Restart phrase"})]})]}),Object(s.jsx)("button",{className:"defaultButton",disabled:"_"===this.state.test_sentence.spoken_tones[this.state.currentIndex]||this.state.currentIndex>=this.state.test_sentence.spoken_tones.length,onClick:this.playNativeVoice,children:"Play Native Speaker Audio"}),Object(s.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center"},children:[Object(s.jsx)("p",{style:{height:"25px"},children:this.state.voice_present?"Voice heard":this.state.recording?"Recording...":""}),Object(s.jsxs)("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",marginTop:"20px"},children:[Object(s.jsxs)("p",{className:"tooltip",style:{fontSize:"14px",marginBlockStart:"-1.5em",marginRight:"20px",width:"50px"},children:["Manual Mode",Object(s.jsx)("span",{class:"tooltiptext",children:"User must press the record button for each character"})]}),Object(s.jsxs)("label",{className:"switch",children:[Object(s.jsx)("input",{type:"checkbox",checked:this.state.automatic_mode,onChange:this.toggleMode}),Object(s.jsx)("span",{className:"slider round"})]}),Object(s.jsxs)("p",{className:"tooltip",style:{fontSize:"14px",width:"50px",marginBlockStart:"-1.5em",marginLeft:"3%"},children:["Automatic Mode",Object(s.jsx)("span",{class:"tooltiptext",children:"Recording will restart automatically after selected chaaracter changes"})]})]}),Object(s.jsxs)("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",marginTop:"20px"},children:[Object(s.jsx)("p",{style:{fontSize:"14px",marginBlockStart:"-1.5em",marginRight:"20px",width:"50px"},children:"Hide Pinyin"}),Object(s.jsxs)("label",{className:"switch",children:[Object(s.jsx)("input",{type:"checkbox",checked:this.state.show_pinyin,onChange:this.togglePinyin}),Object(s.jsx)("span",{className:"slider round"})]}),Object(s.jsx)("p",{style:{fontSize:"14px",width:"50px",marginBlockStart:"-1.5em",marginLeft:"3%"},children:"Show Pinyin"})]})]})]})}}]),n}(r.Component),H=n(83),J="before",W="after",Y="all",K=F.a.connect("".concat("http://localhost:5000")),Q=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).componentDidMount=function(){K.on("predicted_tone",(function(e){var t="_"===r.state.test_sentence.spoken_tones[e.index]?"_":e.prediction.toString(),n=[].concat(Object(E.a)(r.state.tones_recorded),[t]);r.setState({tones_recorded:n},(function(){r.checkPhrase()}))}))},r.checkPhrase=function(){var e=!1;r.state.sentence_finished&&(e=r.state.tones_recorded.every((function(e,t){return e===r.state.test_sentence.spoken_tones[t]}))),e&&r.props.user&&!r.state.test_sentence.is_completed_full&&r.props.mutationFunction(r.state.test_sentence.is_completed_char,!0)},r.componentDidUpdate=function(e){e.sentence.phrase_order&&e.sentence.phrase_order!==r.props.sentence.phrase_order&&r.setState({test_sentence:r.props.sentence})},r.initRecorder=function(e){return z()(e,{type:"audio",sampleRate:44100,bufferSize:2048,numberOfAudioChannels:1,recorderType:z.a.StereoAudioRecorder})},r.startRecording=function(){var e=Object($.a)(r);navigator.mediaDevices.getUserMedia({audio:!0}).then(function(){var t=Object(T.a)(L.a.mark((function t(n){var s;return L.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.recorder=e.initRecorder(n),s={threshold:-1*e.state.threshold_decibels},e.speechEvents=B()(n,s),e.recorder.startRecording(),e.speechEvents.on("speaking",(function(){console.log("speaking"),e.setState({voice_present:!0})})),e.speechEvents.on("stopped_speaking",(function(){console.log("STOPPED SPEAKING"),e.recorder.stopRecording(Object(T.a)(L.a.mark((function t(){var n;return L.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.speechEvents.stop(),t.next=3,e.recorder.getBlob();case 3:n=t.sent,K.emit("phrase_recorded",{voice_recording:n}),e.howler=new H.Howl({src:[URL.createObjectURL(n)],onplay:function(){console.log("PLAY"),e.setState({is_paused:!1,milliseconds:0})},onpause:function(){e.setState({is_playing:!1,is_paused:!0,milliseconds:e.audioProgress.current.valueAsNumber},(function(){cancelAnimationFrame(e.requestRef.current)}))},onend:function(){e.setState({is_playing:!1,milliseconds:e.audioProgress.current.valueAsNumber})},onload:function(){var e=document.getElementById("audio-slider");e.min=0,e.max=1e3*this.duration(),e.value=0},format:["wav"]}),e.setState({voice_present:!1,audio_blob:n,is_recording:!1});case 7:case"end":return t.stop()}}),t)}))))})),e.setState({is_recording:!0});case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},r.setSprites=function(e,t,n){r.howler._sprite={before:[e,t-e],after:[t,n-t],all:[e,n-e]},r.state.character_offsets.forEach((function(e,t){r.howler._sprite[t.toString()]=[e.begin,e.end]}))},r.replayAudio=function(e){if(null!=r.howler){var t=parseInt(r.audioProgress.current.min),n=parseInt(r.audioProgress.current.max),s=parseInt(r.audioProgress.current.valueAsNumber);r.setSprites(t,s,n),r.howler.play(e)}},r.pauseAudio=function(){null!=r.howler&&r.howler.pause()},r.restartSentence=function(){r.howler=null,r.setState({milliseconds:0,tones_recorded:[],character_offsets:[],currentIndex:null,show_pinyin:!1,sentence_finished:!1})},r.playWithSlider=function(){var e=Date.now(),t=document.getElementById("audio-slider"),n=r.audioProgress.current.valueAsNumber;r.replayAudio(W);var s=Object($.a)(r);s.requestRef.current=requestAnimationFrame((function r(){var i=Date.now()-e+n;t.value=i,i<parseInt(t.max)&&(s.requestRef.current=requestAnimationFrame(r))}))},r.updateTime=function(){r.setState({milliseconds:r.audioProgress.current.valueAsNumber})},r.getTone=function(){K.emit("cut_phrase",{begin:parseInt(r.audioProgress.current.min),end:parseInt(r.audioProgress.current.valueAsNumber),character_index:r.state.tones_recorded.length});var e=r.state.tones_recorded.length===r.state.test_sentence.spoken_tones.length-1,t=e||r.state.show_pinyin,n=Object($.a)(r);r.setState((function(n){return{character_offsets:[].concat(Object(E.a)(n.character_offsets),[{begin:parseInt(r.audioProgress.current.min),end:parseInt(r.audioProgress.current.valueAsNumber)-parseInt(r.audioProgress.current.min)}]),sentence_finished:e,show_pinyin:t}}),(function(){n.setSprites(parseInt(r.audioProgress.current.valueAsNumber),parseInt(r.audioProgress.current.valueAsNumber),parseInt(r.audioProgress.current.max));var e=document.getElementById("audio-slider");e.max=r.audioProgress.current.max,e.min=r.audioProgress.current.valueAsNumber,e.value=r.audioProgress.current.valueAsNumber}))},r.handleCharClick=function(e){var t=Object($.a)(r);e<r.state.tones_recorded.length&&r.setState({currentIndex:e},(function(){t.howler.play(e.toString())}))},r.diplayString=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.split("");return Object(s.jsx)("span",{className:"String-holder",children:n.map((function(e,n){return t&&n===r.state.currentIndex?Object(s.jsx)("mark",{onClick:function(){return r.handleCharClick(n)},children:e},n):!t&&n<=r.state.tones_recorded.length-1&&r.state.test_sentence.spoken_tones[n]==r.state.tones_recorded[n]?Object(s.jsx)("mark",{style:{backgroundColor:"green"},onClick:function(){return r.handleCharClick(n)},children:e},n):!t&&n<=r.state.tones_recorded.length-1&&r.state.test_sentence.spoken_tones[n]!=r.state.tones_recorded[n]?Object(s.jsx)("mark",{style:{backgroundColor:"red"},onClick:function(){return r.handleCharClick(n)},children:e},n):Object(s.jsx)("span",{onClick:function(){return r.handleCharClick(n)},children:e},n)}))})},r.displaySlider=function(e){return Object(s.jsx)("div",{style:{height:"3vh"},children:e&&Object(s.jsxs)("div",{children:[Object(s.jsxs)("button",{className:"defaultButton tooltip",onClick:function(){return r.replayAudio(J)},children:[Object(s.jsx)("img",{style:{padding:"0",height:"3vh",width:"2vw"},src:"/play-button.svg"}),Object(s.jsx)("span",{class:"tooltiptext",children:"Play audio left of cursor"})]}),Object(s.jsx)("input",{style:{width:"65%"},id:"audio-slider",ref:r.audioProgress,type:"range",onChange:r.updateTime}),Object(s.jsxs)("button",{className:"defaultButton tooltip",onClick:function(){return r.replayAudio(W)},children:[Object(s.jsx)("img",{style:{padding:"0",height:"3vh",width:"2vw"},src:"/play-button.svg"}),Object(s.jsx)("span",{class:"tooltiptext",children:"Play audio right of cursor"})]})]})})},r.togglePinyin=function(){r.setState({show_pinyin:!r.state.show_pinyin})},r.undoLastTone=function(){var e=Object(E.a)(r.state.character_offsets),t=e.pop(),n=Object(E.a)(r.state.tones_recorded);n.pop(),console.log(e,t);var s=Object($.a)(r);r.setState((function(s){return{character_offsets:e,tones_recorded:n,milliseconds:t.begin,sentence_finished:!1,show_pinyin:s.show_pinyin}}),(function(){s.setSprites(parseInt(t.begin),parseInt(t.begin),parseInt(r.audioProgress.current.max));var e=document.getElementById("audio-slider");e.max=r.audioProgress.current.max,e.min=t.begin,e.value=t.begin}))},r.state={threshold_decibels:50,milliseconds:0,voice_present:!1,is_recording:!1,is_playing:!1,is_paused:!1,sentence_finished:!1,currentIndex:null,character_offsets:[],tones_recorded:[],show_pinyin:!1},r.state.test_sentence=r.props.sentence,r.audioProgress=i.a.createRef(),r.requestRef=i.a.createRef(),r.howler=null,r.recorder=null,r.speechEvents=null,r}return Object(l.a)(n,[{key:"render",value:function(){var e=this,t=(this.state.sentence_finished&&this.state.test_sentence.spoken_tones,null==this.howler);return console.log(this.state),Object(s.jsxs)("div",{children:[Object(s.jsx)("audio",{id:"replay"}),Object(s.jsxs)("div",{style:{display:"inline-flex",flexDirection:"column"},children:[Object(s.jsx)("p",{style:{textAlign:"center",height:"1vh"},children:this.state.show_pinyin&&this.state.test_sentence.pinyin}),Object(s.jsx)("span",{className:"circle "+(this.props.isComplete()?"":"hide")}),Object(s.jsx)("span",{style:{textAlign:"center"},children:this.state.test_sentence.display}),this.diplayString(this.state.test_sentence.characters,!0),this.diplayString(this.state.tones_recorded.join(""),!1)]}),Object(s.jsx)("p",{style:{height:"3vh"},children:this.state.voice_present?"Voice heard":this.state.is_recording?"Recording...":""}),Object(s.jsx)("p",{style:{height:"3vh"},children:this.state.milliseconds?this.state.milliseconds/1e3+" Seconds":null}),this.displaySlider(null!=this.howler),Object(s.jsxs)("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",marginTop:"4vh"},children:[Object(s.jsxs)("button",{className:"tooltip",style:{backgroundColor:this.state.is_recording?"darkgray":"white"},onClick:this.startRecording,children:[Object(s.jsx)("img",{style:{padding:"0",height:"7vh",width:"4vw"},src:"/record-voice-button.svg"}),Object(s.jsx)("span",{class:"tooltiptext",children:"Record voice"})]}),Object(s.jsxs)("button",{className:"tooltip",disabled:t,onClick:function(){return e.setState({is_playing:!0},(function(){e.playWithSlider()}))},children:[Object(s.jsx)("img",{style:{padding:"0",height:"7vh",width:"4vw"},src:"/play-button.svg"}),Object(s.jsx)("span",{class:"tooltiptext",children:"Play audio (cursor will advance)"})]}),Object(s.jsxs)("button",{className:"tooltip",disabled:t||!this.state.is_playing,onClick:this.pauseAudio,children:[Object(s.jsx)("img",{style:{padding:"0",height:"7vh",width:"4vw"},src:"/pause-button.svg"}),Object(s.jsx)("span",{class:"tooltiptext",children:"Pause audio (cursor will stop)"})]}),Object(s.jsxs)("button",{className:"tooltip",disabled:t,onClick:function(){return e.replayAudio(Y)},children:[Object(s.jsx)("img",{style:{padding:"0",height:"7vh",width:"4vw"},src:"/replay-button.svg"}),Object(s.jsx)("span",{class:"tooltiptext",children:"Play entire remaining audio(cursor will not move)"})]}),Object(s.jsxs)("button",{className:"tooltip",disabled:t,onClick:this.undoLastTone,children:[Object(s.jsx)("img",{style:{padding:"0",height:"7vh",width:"4vw"},src:"/backspace-button.svg"}),Object(s.jsx)("span",{class:"tooltiptext",children:"Undo last audio cut"})]}),Object(s.jsxs)("button",{className:"tooltip",disabled:t,onClick:this.restartSentence,children:[Object(s.jsx)("img",{style:{padding:"0",height:"7vh",width:"4vw"},src:"/delete-button.svg"}),Object(s.jsx)("span",{class:"tooltiptext",children:"Restart sentence"})]}),Object(s.jsxs)("button",{className:"tooltip",disabled:t,onClick:this.getTone,children:[Object(s.jsx)("span",{class:"tooltiptext",children:"Get tone of audio left of the cursor"}),"Get Tone"]})]}),Object(s.jsxs)("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",marginTop:"8vh"},children:[Object(s.jsx)("p",{style:{fontSize:"14px",marginBlockStart:"-1.5em",marginRight:"20px",width:"50px"},children:"Hide Pinyin"}),Object(s.jsxs)("label",{className:"switch",children:[Object(s.jsx)("input",{type:"checkbox",checked:this.state.show_pinyin,onChange:this.togglePinyin}),Object(s.jsx)("span",{className:"slider round"})]}),Object(s.jsx)("p",{style:{fontSize:"14px",width:"50px",marginBlockStart:"-1.5em",marginLeft:"3%"},children:"Show Pinyin"})]})]})}}]),n}(r.Component),X=n(51);function Z(){var e=Object(h.a)(["\nmutation updateProgress($deck_id: Int!, $phrase_order: Int!, $is_completed_char: Boolean!, $is_completed_full: Boolean!) {\n  setPhraseLearned(deck_id: $deck_id, phrase_order: $phrase_order, is_completed_char: $is_completed_char, is_completed_full: $is_completed_full){\n    is_completed_char\n    is_completed_full\n  }\n}\n"]);return Z=function(){return e},e}function ee(){var e=Object(h.a)(["\nquery getPhrase($deck_id: Int!) {\n  me {\n    _id\n    user_name\n    user_role\n    user_password\n  }\n  getPhrasesInDeck(deck_id: $deck_id) {\n    phrase_order\n    full_phrase\n    phrase_no_punctuation\n    word_list\n    pinyin\n    pinyin_no_tones\n    written_tones\n    spoken_tones\n    is_completed_char\n    is_completed_full\n  }\n}\n"]);return ee=function(){return e},e}var te=Object(j.a)(ee()),ne=Object(j.a)(Z()),se=function(e){console.log(e);var t=Object(r.useState)(e.location.state.isFullSentenceMode),n=Object(A.a)(t,2),i=n[0],c=n[1],a=Object(p.f)(),o=a.deckId,l=a.phraseOrder,d=Object(r.useRef)(),u=Object(r.useRef)(),h=Object(X.b)(te,{variables:{deck_id:parseInt(o)}}),j=h.loading,b=h.error,_=h.data,g=Object(X.a)(ne),m=Object(A.a)(g,2),f=m[0];m[1].mutationData;if(j)return"Loading...";if(b)return"Error! ".concat(b.message);function x(e){c(e)}function v(e){console.log(e);var t={};return t.deck_id=parseInt(o),t.phrase_order=parseInt(l),t.display=e.full_phrase,t.characters=e.phrase_no_punctuation,t.pinyin=e.pinyin.join(" "),t.spoken_tones=e.spoken_tones.join("").replaceAll("5","_"),t.pinyin_no_tones=e.pinyin_no_tones,t.phrase_order=e.phrase_order,t.is_completed_char=e.is_completed_char||!1,t.is_completed_full=e.is_completed_full||!1,console.log(t),t}function O(t,n){i?u.current.restartSentence():d.current.restartSentence(),function(e,t,n,s){e.history.push({pathname:"/learn/"+t+"/"+n,state:{isFullSentenceMode:s}})}(e,t,n,i)}function y(e,t){f({variables:{deck_id:parseInt(o),phrase_order:parseInt(l),is_completed_char:e,is_completed_full:t},update:function(n){var s=n.readQuery({query:te,variables:{deck_id:parseInt(o)}});s.getPhrasesInDeck[l-1].is_completed_char=e,s.getPhrasesInDeck[l-1].is_completed_full=t,n.writeQuery({query:te,data:s})}})}function k(){return _.getPhrasesInDeck[l-1].is_completed_char&&!i||_.getPhrasesInDeck[l-1].is_completed_full&&i}return Object(s.jsxs)("div",{className:"LearnContainer",children:[Object(s.jsxs)("div",{className:"Navbar",children:[Object(s.jsx)("p",{className:i?"":"selectedItem",onClick:function(){return x(!1)},children:"Character by Character"}),Object(s.jsx)("p",{className:i?"selectedItem":"",onClick:function(){return x(!0)},children:"Full Sentence"})]}),Object(s.jsxs)("div",{className:"toneTrainingInterface",children:[Object(s.jsxs)("button",{className:"tooltip",disabled:"1"===l,style:{marginRight:"5%"},onClick:function(){return O(o,parseInt(l)-1)},children:[Object(s.jsx)("img",{style:{padding:"0",height:"7vh",width:"4vw"},src:"/left-arrow-button.svg"}),Object(s.jsx)("span",{class:"tooltiptext",children:"Previous phrase"})]}),Object(s.jsx)("div",{style:{width:"75%"},children:i?Object(s.jsx)(Q,{ref:u,isComplete:k,user:_.me,sentence:v(_.getPhrasesInDeck[l-1]),mutationFunction:y}):Object(s.jsx)(G,{ref:d,isComplete:k,user:_.me,sentence:v(_.getPhrasesInDeck[l-1]),mutationFunction:y})}),Object(s.jsxs)("button",{className:"tooltip",disabled:parseInt(l)===_.getPhrasesInDeck.length,style:{marginLeft:"5%"},onClick:function(){return O(o,parseInt(l)+1)},children:[Object(s.jsx)("img",{style:{padding:"0",height:"7vh",width:"4vw"},src:"/right-arrow-button.svg"}),Object(s.jsx)("span",{style:{left:"inherit",right:"105%"},class:"tooltiptext",children:"Next phrase"})]})]})]})};function re(){var e=Object(h.a)(["\nquery getUser {\n  me {\n    _id\n    user_name\n    user_role\n    user_password\n  }\n}\n"]);return re=function(){return e},e}var ie=Object(j.a)(re()),ce=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){return Object(s.jsx)("div",{children:Object(s.jsx)(b.b,{query:ie,children:function(e){var t=e.loading,n=e.error,r=e.data,i=e.refetch;if(t)return Object(s.jsx)("div",{children:"Fetching"});if(n)return Object(s.jsx)("div",{children:"error"});var c=r.me;return Object(s.jsxs)("div",{children:[Object(s.jsx)(S,{user:c,refetchUser:i}),Object(s.jsx)("div",{className:"App",children:Object(s.jsx)("header",{className:"App-header",children:Object(s.jsxs)(p.c,{children:[Object(s.jsx)(p.a,{exact:!0,path:"/dashboard",user:c,component:R}),Object(s.jsx)(p.a,{exact:!0,path:"/learn/:deckId/:phraseOrder",component:se}),Object(s.jsx)(p.a,{exact:!0,path:"/login",render:function(){return Object(s.jsx)(y,{user:c,refetchUser:i})}})]})})})]})}})})}}]),n}(r.Component),ae=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,131)).then((function(t){var n=t.getCLS,s=t.getFID,r=t.getFCP,i=t.getLCP,c=t.getTTFB;n(e),s(e),r(e),i(e),c(e)}))},oe=n(8),le=n(31),de=n(85),ue=n(84),he=Object(de.a)({uri:"/graphql",credentials:"include"}),pe=new le.a({link:he,cache:new ue.a});a.a.render(Object(s.jsx)(k.a,{children:Object(s.jsx)(oe.a,{client:pe,children:Object(s.jsx)(ce,{})})}),document.getElementById("root")),ae()},75:function(e,t,n){},76:function(e,t,n){}},[[128,1,2]]]);
//# sourceMappingURL=main.dc1e7a66.chunk.js.map